generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = "postgresql://postgres.wgdxgzraacfhfbxvxuzy:@Kinantiku1@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=1"
  directUrl = "postgresql://postgres.wgdxgzraacfhfbxvxuzy:@Kinantiku1@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres?pgbouncer=true&connection_limit=1"
}

model User {
  id          Int                    @id @default(autoincrement())
  nama        String
  phone       String                 @unique
  password    String                 @default("")
  role        Role
  kelas       Kelas?
  guruTugas   Assignment[]           @relation("GuruTugas")
  tugas       AssignmentStatus[]
  submissions AssignmentSubmission[]
}

model Assignment {
  id           Int                    @id @default(autoincrement())
  kode         String                 @unique
  guruId       Int
  judul        String
  deskripsi    String
  pdfUrl       String?
  lampirkanPDF Boolean                @default(false)
  createdAt    DateTime               @default(now())
  kelas        String
  deadline     DateTime?
  kunciJawaban String?
  guru         User                   @relation("GuruTugas", fields: [guruId], references: [id])
  status       AssignmentStatus[]
  submissions  AssignmentSubmission[]
}

model AssignmentStatus {
  id      Int         @id @default(autoincrement())
  siswaId Int
  tugasId Int
  status  TugasStatus @default(BELUM_SELESAI)
  siswa   User        @relation(fields: [siswaId], references: [id])
  tugas   Assignment  @relation(fields: [tugasId], references: [id], onDelete: Cascade)
}

model AssignmentSubmission {
  id         Int         @id @default(autoincrement())
  siswaId    Int
  tugasId    Int
  pdfUrl     String?
  status     TugasStatus @default(SELESAI)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  evaluation String?
  grade      String?
  score      Int?
  siswa      User        @relation(fields: [siswaId], references: [id])
  tugas      Assignment  @relation(fields: [tugasId], references: [id], onDelete: Cascade)
}

model PhoneJidMapping {
  id        Int      @id @default(autoincrement())
  phone     String   @unique
  jid       String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  guru
  siswa
}

enum Kelas {
  XTKJ1
  XTKJ2
  XITKJ1
  XITKJ2
  XIITKJ1
  XIITKJ2
  TPTUP
}

enum TugasStatus {
  BELUM_SELESAI
  SELESAI
}
